# 機能構成図

## 1) 機能ツリー（親→子→孫）

```
[公開閲覧]──M
 ├─ トップ表示（ホーム画面）──M
 │    └─ 主CTA（最重要ボタン）表示──M
 ├─ リンク集（GitHub/LinkedIn/Email の3点）──M
 │    ├─ 新規タブ遷移（GitHub/LinkedIn）──M
 │    └─ メーラー起動（mailto、件名自動付与）──M
 ├─ アクセシビリティ配慮（キーボード操作/コントラスト）──M
 └─ ヘルスチェック（生存確認API `/health`）──M

[問い合わせ]──M
 ├─ 入力（email/name/body/consent）──M
 ├─ バリデーション（形式/桁数/同意）──M
 ├─ Bot対策（Turnstile：ロボット判定）──M
 ├─ 保存（RDS：データベース）──M
 └─ エラー応答（400/fieldErrors）──M

[エラーハンドリング]──M
 ├─ 404（ページなし）──M
 └─ 500（サーバー内部エラー）──M

[解析（GA4：アクセス解析）]──S
 ├─ 日次UU（ユニーク利用者数）取得──S
 ├─ 日次PV（ページ閲覧数）取得──S
 └─ 流入上位5の確認（週1で閲覧可）──S

[運用（Ops）]──M
 ├─ デプロイ自動反映（GitHub Actions→SSM）──M
 ├─ ロールバック（直前版へ復帰）──M
 └─ 掃除ジョブ（90日で問い合わせ削除）──M

[ドキュメント]──S
 ├─ 図/手順/結果の集約（/docs）──S
 └─ 解析キャプチャ格納（/docs/analytics/）──S
```

- **M**=Must（絶対必要）、**S**=Should（できれば欲しい）
    
- スコープ外（**Out**）：レビュー投稿/決済/CMS/認証/多言語 など（v1.2の宣言どおり）
    

---

## 2) 機能テーブル（優先度・スコープ・依存つき）

|親機能|子機能|説明（初心者カッコ）|優先度|スコープ|依存（カッコで一言）|
|---|---|---|---|---|---|
|公開閲覧|トップ表示|ルート表示と概要・主CTA（最重要ボタン）|M|In|–|
|公開閲覧|リンク集3点|GitHub/LinkedIn/Email の3リンクだけ|M|In|–|
|公開閲覧|新規タブ/メーラー|外部は新規タブ／Emailは `mailto`（件名自動）|M|In|ブラウザ機能|
|公開閲覧|アクセシビリティ|Tab順/ラベル/コントラスト（4.5:1）|M|In|–|
|公開閲覧|ヘルスチェック|`/health` で稼働確認（生存確認API）|M|In|–|
|問い合わせ|入力/検証|email形式/文字数/同意|M|In|–|
|問い合わせ|Bot対策|Turnstile（ロボット除外）|M|In|Turnstile（外部サービス）|
|問い合わせ|保存|RDSに1行保存（データベース）|M|In|RDS|
|問い合わせ|エラー返却|400 + `fieldErrors`|M|In|–|
|エラーハンドリング|404/500|見つからない/内部エラー表示|M|In|–|
|解析（GA4）|指標閲覧|日次UU・日次PV・流入上位5を週1で確認|S|In|GA4（アクセス解析）|
|運用|デプロイ自動反映|GitHub Actions→SSM で配布|M|In|GitHub Actions / SSM|
|運用|ロールバック|失敗時、直前版へ切替|M|In|リリース管理|
|運用|掃除ジョブ|90日超の問い合わせを削除|M|In|スケジューラ|
|ドキュメント|証跡集約|図/手順/試験/費用を `/docs` 集約|S|In|–|

---

## 3) 機能間の依存（矢印で把握）

```
問い合わせ入力 → 検証 → Bot対策(Turnstile) → 保存(RDS)
公開閲覧 → 解析(GA4)〔計測対象ページ：トップ/リンク集/エラー〕
GitHub Actions → SSMコマンド → デプロイ/ロールバック（運用）
```

---

## 4) “機能構成図”のFigma置き換えパーツ（そのまま作れる最小セット）

- **親ノード**（太枠）
    
    - 公開閲覧 / 問い合わせ / エラーハンドリング / 解析(GA4) / 運用 / ドキュメント
        
- **子ノード**（通常枠、右上にチップ）
    
    - 例：_リンク集（M / In）_、_Bot対策（M / In）_、_指標閲覧（S / In）_ …
        
- **記法**
    
    - **チップ**：`M/S/C/W`（優先度）・`In/Out/Later`（スコープ）
        
    - **依存**：コネクタ矢印（例：_Bot対策_ → _保存_）
        
    - **注記**：外部サービスに小ラベル（_GA4（アクセス解析）_、_RDS（DB）_、_Turnstile（Bot対策）_）
        

---

## 5) スコープ外（Out：今回やらない／理由）

- **レビュー投稿／決済／CMS／認証／多言語**：用途に対し重い（PoC超過）
    
- **多AZ冗長化／APM／NAT構成**：信頼性・運用の“手数”がPoC要件（10分反映/復帰・月10USD）とトレードオフ
    

---

## 6) 用語の一行メモ（初心者カッコ）

- **CTA（最重要ボタン）**：一番押してほしい導線
    
- **ヘルスチェック（生存確認API）**：動いているか機械的に確認するための軽い応答
    
- **Turnstile（Bot対策）**：Cloudflareの“人間判定”サービス
    
- **RDS（データベース）**：問い合わせ内容をしまっておく保管庫
    
- **GA4（アクセス解析）**：どれくらい見られたかを数える道具
    
- **UU（ユニークユーザー）**：被った分を抜いた人数
    
- **PV（ページビュー）**：ページが開かれた回数
    
- **ロールバック（直前版に戻す）**：失敗した更新を巻き戻すこと
    

---

## 7) 仕上げチェック（このStationの合格ライン）

- 親→子→孫が**3層以内**、各ノードに**M/S/C/W**と**In/Out/Later**
    
- **依存の矢印**が引けている（問い合わせは_Bot対策→保存_の順）
    
- **スコープ外**が明記されている（理由つき）
    
- これをFigma/Excalidraw化して `/docs/station03/doc.md` に**画像またはリンク**を貼る
    
